!function(){"use strict";class n{static t(n="codec_user_id"){let t=(n=>{const t=document.cookie.match(new RegExp("(^| )"+n+"=([^;]+)"));return t?decodeURIComponent(t[2]):null})(n);return t?console.log("[MyAdSDK] Existing user_id:",t):(t=this.o(),((n,t,e=365)=>{const o=new Date(Date.now()+864e5*e).toUTCString();document.cookie=`${n}=${encodeURIComponent(t)}; expires=${o}; path=/; Secure; SameSite=Lax`})(n,t),console.log("[MyAdSDK] New user_id created:",t)),t}static o(){if("undefined"!=typeof crypto&&crypto.randomUUID)return crypto.randomUUID();const n=crypto.getRandomValues(new Uint8Array(16));n[6]=15&n[6]|64,n[8]=63&n[8]|128;const t=[...n].map(n=>n.toString(16).padStart(2,"0")).join("");return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20)}`}static i(){const n=navigator.userAgent;return n.includes("Win")?"Windows":n.includes("Mac")?"MacOS":n.includes("Linux")?"Linux":/Android/i.test(n)?"Android":/iPhone|iPad|iPod/i.test(n)?"iOS":"Unknown"}static l(){const n=navigator.userAgent;return/Mobi|Android/i.test(n)?"mobile":/Tablet|iPad/i.test(n)?"tablet":"desktop"}static u(){return{type:this.l(),os:this.i(),ua:navigator.userAgent,language:navigator.language,screen:{width:window.screen.width,height:window.screen.height},viewport:{width:window.innerWidth,height:window.innerHeight,dpr:window.devicePixelRatio||1}}}static p(){return{url:window.location.href,ref:document.referrer||null}}static v(n){return{page:this.p(),slot:n,device:this.u(),userId:this.t()}}}!function(t,e){function o(){const n=t._arfQueue;if(!n.length)return;let e;for(console.log("[SDK] Processing queue...");e=n.shift();)i({h:e.device,S:e.domain,D:e.zone})}function i(t){const o=n.l(),i=n.p();console.log("params",t),o.toLocaleLowerCase()===t.h.toLocaleLowerCase()&&function(n,t){const e=n=>{if(!n)return null;try{return/^https?:\/\//i.test(n)||(n="https://"+n),new URL(n).hostname.replace(/^www\./,"").toLowerCase()}catch(n){return null}},o=e(n),i=e(t);return null!==o&&o===i}(i.url,t.S)&&async function(t){var o;console.log("[SDK] → Gọi API lấy quảng cáo...");const i=n.v({id:t});try{const n=await fetch("http://192.168.1.26:3000/api/v1/ad-sever/ads/inventory/outstream/creative-v2",{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*","Accept-Language":"en-US,en;q=0.9,vi;q=0.8"},body:JSON.stringify(i)}),t=await n.json();if(console.log("[SDK] ← Response:",t),t.success&&201===t.code&&(null===(o=t.data)||void 0===o?void 0:o.src)){const n=e.createElement("script");n.text=t.data.src,e.head.appendChild(n),n.remove(),console.log("[SDK] ✅ Đã thực thi script callback")}else console.warn("[SDK] ⚠️ Không có data.src hợp lệ trong response")}catch(n){console.error("[SDK] ❌ Lỗi khi gọi adserver:",n)}}(t.D)}console.log("[SDK] main-sdk.ts loaded"),t.__arf_sdk_loaded__=!0,t._arfQueue=t._arfQueue||[],t._arfPlugins=t._arfPlugins||{},t.sspcallback=function(n){var o,i;console.log("[SDK] sspcallback() data:",n);const c=null===(o=n.data)||void 0===o?void 0:o[0],s=null===(i=null==c?void 0:c.creatives)||void 0===i?void 0:i[0];if(!n.formatType)throw new Error("lỗi k có format");s?function(n,o){if(t._arfPlugins[n])return void o();const i=e.createElement("script");i.src=`https://cdn.jsdelivr.net/gh/datcaoquoc/codecsdk@v1.0.8/dist/plugin-${n}.min.js`,i.async=!0,i.onload=()=>{console.log(`[SDK] Plugin '${n}' loaded`),o()},i.onerror=()=>console.error(`[SDK] Failed to load plugin ${n}`),e.head.appendChild(i)}(n.formatType,()=>{const e=t._arfPlugins[n.formatType];"function"==typeof e?e({campaignId:c.campaignId,creativeInfo:s,slotId:null==n?void 0:n.slotId,transactionId:null==n?void 0:n.transactionId,eventContext:null==n?void 0:n.eventContext,unit:n.unit,userId:n.userId,options:n.ext.options}):console.warn(`[SDK] Plugin '${n.formatType}' không khả dụng.`)}):console.warn("[SDK] No ad creative found in payload")},o(),new MutationObserver(o).observe(e.documentElement,{childList:!0,subtree:!0}),t._arfProcessQueue=o}(window,document)}();
