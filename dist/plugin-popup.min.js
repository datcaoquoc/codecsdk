!function(){"use strict";var n,t,e,o;!function(n){n.BANNER="banner",n.NATIVE="native",n.VIDEO="video",n.POPUP="popup",n.FLOAT="float"}(n||(n={})),function(n){n.ON_LOAD="on_load",n.ON_DELAY="delay",n.ON_SCROLL="scroll",n.ON_CLICK="click",n.ON_INACTIVITY="inactivity"}(t||(t={})),function(n){n.BOTTOM_LEFT="bottom-left",n.BOTTOM_RIGHT="bottom-right",n.BOTTOM_CENTER="bottom-center",n.TOP_LEFT="top-left",n.TOP_RIGHT="top-right",n.TOP_CENTER="top-center",n.CENTER_LEFT="center-left",n.CENTER_RIGHT="center-right"}(e||(e={})),function(n){n.IMPRESSION="impression",n.CLICK="click",n.ERROR="error"}(o||(o={}));class i{constructor(){this.endpoint="http://113.161.103.134:8096/api/v1/tracking/events/codec.gif"}t(n){const{campaignId:t,context:e,creativeInfo:i,inventId:a,transactionId:c,unit:r,userId:s}=n,d=this.o({cr:null==i?void 0:i.creativeId,ad_type:"OUTSTREAM",event:o.IMPRESSION,transaction_id:c,ev_context:e,user_id:s,unit:r,cp:t,iv:a}),l=`${this.endpoint}?${d}`;(new Image).src=l}i(n){const{campaignId:t,context:e,creativeInfo:i,inventId:a,transactionId:c,unit:r,userId:s,url:d}=n,l=this.o({cr:null==i?void 0:i.creativeId,ad_type:"OUTSTREAM",event:o.CLICK,transaction_id:c,ev_context:e,user_id:s,unit:r,cp:t,iv:a,url:d});return`${this.endpoint}?${l}`}uuid(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,n=>{const t=16*Math.random()|0;return("x"===n?t:3&t|8).toString(16)})}o(n){return Object.entries(n).map(([n,t])=>`${encodeURIComponent(n)}=${encodeURIComponent(t)}`).join("&")}}window.AdTracking=new i,window._arfPlugins=window._arfPlugins||{},window._arfPlugins.popup=function({campaignId:n,creativeInfo:e,slotId:o,transactionId:a,eventContext:c,unit:r,userId:s,options:d}){if(!d)return;const l=d,u=l.trigger,p=l.triggerTime||5,f=!1!==l.closeButton,x=!1!==l.overlay;let g=e.width||400,m=e.height||300;if(l.size&&"string"==typeof l.size){const[n,t]=l.size.split("x").map(Number);n&&t&&(g=n,m=t)}function b(){var t;const d=function(){const n=document.createElement("iframe");return n.src="about:blank",n.style.cssText="\n      position: fixed;\n      inset: 0;\n      width: 100%;\n      height: 100%;\n      border: none;\n      z-index: 999999;\n      background: transparent;\n      display: block;\n    ",document.body.appendChild(n),n}(),l=d.contentDocument||(null===(t=d.contentWindow)||void 0===t?void 0:t.document);if(!l)return;const u=(new i).i({campaignId:n,context:c,creativeInfo:e,inventId:o,transactionId:a,unit:r,userId:s,url:e.ldp}),p=`\n      <html>\n        <head>\n          <style>\n            body {\n              margin: 0;\n              padding: 0;\n              background: ${x?"rgba(0,0,0,0.5)":"transparent"};\n              display: flex;\n              justify-content: center;\n              align-items: center;\n              animation: fadeIn 0.3s ease forwards;\n              font-family: sans-serif;\n            }\n\n            @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n            @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }\n\n            @keyframes scaleIn {\n              from { transform: scale(0.8); opacity: 0; }\n              to { transform: scale(1); opacity: 1; }\n            }\n            @keyframes scaleOut {\n              from { transform: scale(1); opacity: 1; }\n              to { transform: scale(0.8); opacity: 0; }\n            }\n\n            .popup {\n              width: ${g}px;\n              height: ${m}px;\n              background: #fff;\n              overflow: hidden;\n              box-shadow: 0 5px 30px rgba(0,0,0,0.3);\n              position: relative;\n              animation: scaleIn 0.3s ease forwards;\n            }\n\n            .popup.closing {\n              animation: scaleOut 0.3s ease forwards;\n            }\n\n            .close-btn {\n                  position: absolute;\n    top: 4px;\n    right: 4px;\n    width: 26px;\n    height: 26px;\n    line-height: 28px;\n    text-align: center;\n    font-size: 22px;\n    color: #fff;\n    background: rgba(0, 0, 0, 0.6);\n    border-radius: 10%;\n    cursor: pointer;\n    z-index: 10;\n    transition: background 0.2s \nease;\n            }\n\n            .close-btn:hover {\n              background: rgba(0, 0, 0, 0.85);\n            }\n\n            a.banner {\n              display: block;\n              width: 100%;\n              height: 100%;\n              background: url('${e.content_url}') center/cover no-repeat;\n            }\n          </style>\n        </head>\n        <body>\n          <div class="popup">\n            ${f?'<div class="close-btn">&times;</div>':""}\n            <a class="banner" href="${u}" target="_blank"></a>\n          </div>\n        </body>\n      </html>\n    `;l.open(),l.write(p),l.close(),(new i).t({campaignId:n,context:c,creativeInfo:e,inventId:o,transactionId:a,unit:r,userId:s}),d.onload=()=>{const n=l.querySelector(".close-btn"),t=l.querySelector(".popup"),e=()=>{t?(t.classList.add("closing"),l.body.style.animation="fadeOut 0.3s ease forwards",setTimeout(()=>{document.body.removeChild(d),console.log(`[Plugin:Popup] Đã đóng popup ${o}`)},300)):document.body.removeChild(d)};n&&n.addEventListener("click",e),x&&l.body.addEventListener("click",n=>{n.target===l.body&&e()})}}switch(u){case t.ON_LOAD:window.addEventListener("load",()=>b());break;case t.ON_DELAY:setTimeout(b,1e3*p);break;case t.ON_SCROLL:const n=t=>{(window.scrollY+window.innerHeight)/document.body.scrollHeight>=.5&&(b(),window.removeEventListener("scroll",n))};window.addEventListener("scroll",n);break;case t.ON_CLICK:if(l.selector){const n=document.querySelector(l.selector);n?n.addEventListener("click",b):console.warn(`[Plugin:Popup] Không tìm thấy selector ${l.selector}`)}break;case t.ON_INACTIVITY:let e;const i=()=>{clearTimeout(e),e=setTimeout(b,1e3*p)};["mousemove","keydown","scroll","click"].forEach(n=>window.addEventListener(n,i)),i();break;default:console.warn(`[Plugin:Popup] Không có trigger hợp lệ cho popup ${o}`)}console.log(`[Plugin:Popup] Popup ${o} đăng ký trigger "${u}".`)}}();
