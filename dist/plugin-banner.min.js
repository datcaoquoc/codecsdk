!function(){"use strict";var n,e,t,o;!function(n){n.BANNER="banner",n.NATIVE="native",n.VIDEO="video",n.POPUP="popup",n.FLOAT="float"}(n||(n={})),function(n){n.ON_LOAD="on_load",n.ON_DELAY="delay",n.ON_SCROLL="scroll",n.ON_CLICK="click",n.ON_INACTIVITY="inactivity"}(e||(e={})),function(n){n.BOTTOM_LEFT="bottom-left",n.BOTTOM_RIGHT="bottom-right",n.BOTTOM_CENTER="bottom-center",n.TOP_LEFT="top-left",n.TOP_RIGHT="top-right",n.TOP_CENTER="top-center",n.CENTER_LEFT="center-left",n.CENTER_RIGHT="center-right"}(t||(t={})),function(n){n.IMPRESSION="impression",n.CLICK="click",n.ERROR="error"}(o||(o={}));class i{constructor(){this.endpoint="http://113.161.103.134:8096/api/v1/tracking/events/codec.gif"}t(n){const{campaignId:e,context:t,creativeInfo:i,inventId:c,transactionId:r,unit:s,userId:a}=n,d=this.o({cr:null==i?void 0:i.creativeId,ad_type:"OUTSTREAM",event:o.IMPRESSION,transaction_id:r,ev_context:t,user_id:a,unit:s,cp:e,iv:c}),u=`${this.endpoint}?${d}`;(new Image).src=u}i(n){const{campaignId:e,context:t,creativeInfo:i,inventId:c,transactionId:r,unit:s,userId:a,url:d}=n,u=this.o({cr:null==i?void 0:i.creativeId,ad_type:"OUTSTREAM",event:o.CLICK,transaction_id:r,ev_context:t,user_id:a,unit:s,cp:e,iv:c,url:d});return`${this.endpoint}?${u}`}uuid(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=16*Math.random()|0;return("x"===n?e:3&e|8).toString(16)})}o(n){return Object.entries(n).map(([n,e])=>`${encodeURIComponent(n)}=${encodeURIComponent(e)}`).join("&")}}window.AdTracking=new i;const c={};window._arfPlugins=window._arfPlugins||{},window._arfPlugins.banner=function({campaignId:n,creativeInfo:e,slotId:t,transactionId:o,eventContext:r,unit:s,userId:a,options:d}){var u,l;let x=document.getElementById(`slot-${t}`);if(!x)return;x.innerHTML="";const v=document.createElement("iframe");v.width=e.width.toString(),v.height=e.height.toString(),v.frameBorder="0",v.style.border="none",x.appendChild(v);const I=v.contentDocument||(null===(u=v.contentWindow)||void 0===u?void 0:u.document);if(!I)return void console.warn("[Plugin:Banner] Cannot access iframe document.");I.open();const g=(new i).i({campaignId:n,context:r,creativeInfo:e,inventId:t,transactionId:o,unit:s,userId:a,url:e.ldp});var p;I.write(`\n    <html>\n      <head><style>body{margin:0;padding:0;overflow:hidden}</style></head>\n      <body>\n        <a href="${g||"#"}" target="_blank"\n           style="display:block;width:100%;height:100%;\n           background:url('${null==e?void 0:e.content_url}') center/cover no-repeat;"></a>\n        <script src="https://cdn.jsdelivr.net/gh/datcaoquoc/codecsdk@v1.0.5/dist/plugin-codeclogo.min.js"><\/script>\n      </body>\n    </html>\n  `),I.close(),p={campaignId:n,container:x,context:r,creative:e,slotId:t,transactionId:o,unit:s,userId:a},new IntersectionObserver((n,e)=>{n.forEach(n=>{n.isIntersecting&&n.intersectionRatio>=.5&&(console.log("[Tracking] Banner visible 50%+ => send impression"),(new i).t({campaignId:p.campaignId,context:p.context,creativeInfo:p.creative,inventId:p.slotId,transactionId:p.transactionId,unit:p.unit,userId:p.userId}),e.disconnect())})},{threshold:[.5]}).observe(p.container),console.log(`[Plugin:Banner] Rendered zone ${t}`);const h=d||{},f=h.refreshInterval||30,m=h.maxRefresh||0;if((null===(l=c[t])||void 0===l?void 0:l.timer)&&clearTimeout(c[t].timer),c[t]||(c[t]={count:0}),c[t].count<m){console.log(`[Plugin:Banner] Zone ${t} sẽ refresh sau ${f}s (Lần ${c[t].count+1}/${m})`);const n=setTimeout(()=>{c[t].count+=1,console.log(`[Plugin:Banner] Refreshing zone ${t}...`),window._arfQueue&&window._arfProcessQueue?(window._arfQueue.push({zone:t}),window._arfProcessQueue()):console.warn("[Plugin:Banner] Không tìm thấy _arfQueue hoặc _arfProcessQueue")},1e3*f);c[t].timer=n}else console.log(`[Plugin:Banner] Zone ${t} đã đạt giới hạn refresh.`)}}();
